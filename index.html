<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EditCraft</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#0f0f0f;color:#fff;display:flex;justify-content:center;align-items:center;min-height:100vh}
.card{background:#1c1c1c;padding:25px;border-radius:16px;max-width:420px;width:100%;text-align:center}
button{width:100%;padding:12px;margin-top:12px;border:none;border-radius:8px;font-weight:bold;cursor:pointer}
iframe{width:100%;height:550px;border:none;margin-top:15px;border-radius:10px}
</style>
</head>
<body>

<div class="card">
  <h1>EditCraft</h1>
  <p>Login to continue</p>

  <button id="loginBtn">Sign in with Google</button>

  <div id="userArea" style="display:none;">
    <p id="userName"></p>
    <iframe src="https://docs.google.com/forms/d/e/XXXXXXXX/viewform?embedded=true"></iframe>
    <button onclick="logout()">Logout</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, query, where, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"YOUR_API_KEY",
  authDomain:"editcraft-353dd.firebaseapp.com",
  projectId:"editcraft-353dd",
  appId:"1:188093539489:web:d1e58f0bd5da4b979abce0"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

const loginBtn = document.getElementById("loginBtn");
const userArea = document.getElementById("userArea");

loginBtn.onclick = async () => {
  const res = await signInWithPopup(auth, provider);
  const u = res.user;

  // ðŸ”’ BLOCK MULTIPLE LOGINS (1 per day)
  const today = new Date().toISOString().slice(0,10);
  const q = query(
    collection(db,"logins"),
    where("email","==",u.email),
    where("date","==",today)
  );
  const snap = await getDocs(q);
  if(!snap.empty){
    alert("You already logged in today");
    return;
  }

  await addDoc(collection(db,"logins"),{
    name:u.displayName,
    email:u.email,
    date:today,
    time:serverTimestamp()
  });

  userArea.style.display="block";
  loginBtn.style.display="none";
  userName.innerText = "Welcome " + u.displayName;
};

window.logout = () => {
  signOut(auth);
  location.reload();
};
</script>
</body>
</html>
